networks:
  app: # main network

services:

  rest_server:
    container_name: pokedex-rest-server
    build:
      context: .
      dockerfile: ${DOCKERFILE}
    image: pokedex-${DOCKER_IMAGE_SUFFIX}
    environment:
      - DEBUG=${DEBUG}
      - LOG_LEVEL=${LOG_LEVEL}
      - WAIT_FOR_DEBUGGER=${REST_WAIT_FOR_DEBUGGER}
      - PREFERRED_LANGUAGE=${PREFERRED_LANGUAGE}
      - POKEAPI_BASE_URL=${POKEAPI_BASE_URL}
      - FUNTRANSLATIONS_BASE_URL=${FUNTRANSLATIONS_BASE_URL}
      - FUNTRANSLATIONS_SHAKESPEARE_PATH=${FUNTRANSLATIONS_SHAKESPEARE_PATH}
      - FUNTRANSLATIONS_YODA_PATH=${FUNTRANSLATIONS_YODA_PATH}
      - HTTP_TIMEOUT_SECONDS=${HTTP_TIMEOUT_SECONDS}
      - CACHE_ENABLED=${CACHE_ENABLED}
      - CACHE_TTL_SECONDS=${CACHE_TTL_SECONDS}
      - CACHE_MAXSIZE=${CACHE_MAXSIZE}
      - SENTRY_ENABLED=${SENTRY_ENABLED}
      - SENTRY_DSN=${SENTRY_DSN}
      - SENTRY_ENVIRONMENT=${SENTRY_ENVIRONMENT}
      - SENTRY_RELEASE=${SENTRY_RELEASE}
      - SENTRY_TRACES_SAMPLE_RATE=${SENTRY_TRACES_SAMPLE_RATE}
      - SENTRY_PROFILES_SAMPLE_RATE=${SENTRY_PROFILES_SAMPLE_RATE}
      - SENTRY_SEND_DEFAULT_PII=${SENTRY_SEND_DEFAULT_PII}
      - RETRY_ENABLED=${RETRY_ENABLED}
      - RETRY_ATTEMPTS=${RETRY_ATTEMPTS}
    ports:
      - ${REST_EXPOSED_SERVER_PORT}:8000
      - ${REST_DEBUG_PORT:-5678}:5678
    volumes:
      - ./src/pokedex:/home/app/project/src/pokedex
      - ./tests:/home/app/project/tests
      # copy pyptoject.toml in the code folder to be able to provide coverage and other settings at runtime
      - ./pyproject.toml:/home/app/project/pyproject.toml
      # test coverage results
      - ./htmlcov:/home/app/project/htmlcov
    networks:
      - app
